<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ 2</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .content {
            padding: 16px;
            padding-bottom: 80px;
            max-width: 600px;
            margin: 0 auto;
            padding-top: 24px;
        }

        .recipes-stories {
            margin-bottom: 16px;
            display: block;
        }

        .stories-container {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 8px 4px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .stories-container::-webkit-scrollbar {
            display: none;
        }

        .story-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 70px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .story-item:hover {
            transform: scale(1.05);
        }

        .story-circle {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 6px;
            border: 3px solid transparent;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .story-item.active .story-circle {
            border-color: #6200ea;
            background: linear-gradient(135deg, #6200ea, #7c4dff);
            color: white;
        }

        .story-item.add-new .story-circle {
            background: linear-gradient(135deg, #ff4081, #f50057);
            color: white;
            font-size: 28px;
            font-weight: 300;
        }

        .story-name {
            font-size: 12px;
            color: #666;
            text-align: center;
            font-weight: 500;
            max-width: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .story-item.active .story-name {
            color: #6200ea;
            font-weight: 600;
        }

        .back-button {
            display: none; /* –£–±–∏—Ä–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥ */
        }

        .input-section {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .input-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            border: none;
            outline: none;
            font-size: 16px;
            padding: 12px 16px;
            background: #f5f5f5;
            border-radius: 8px;
            font-family: 'Roboto', sans-serif;
        }

        .add-button {
            background: #6200ea;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 24px;
            color: white;
            font-family: 'Roboto', sans-serif;
            font-weight: 300;
        }

        .add-button:hover {
            background: #5a00d6;
            transform: scale(1.05);
        }

        .category-section {
            background: white;
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .category-header {
            background: linear-gradient(135deg, #6200ea, #7c4dff);
            color: white;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .category-title {
            font-size: 18px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-count {
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 500;
        }

        .category-items {
            padding: 8px 0;
        }

        .item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            transition: background 0.2s;
            cursor: pointer;
        }

        .item:hover {
            background: #f5f5f5;
        }

        .item.completed {
            opacity: 0.6;
        }

        .item.completed .item-text {
            text-decoration: line-through;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #6200ea;
            border-radius: 4px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox.checked {
            background: #6200ea;
        }

        .checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .item-text {
            flex: 1;
            font-size: 16px;
            color: #333;
        }

        .delete-button {
            color: #999;
            cursor: pointer;
            transition: color 0.2s;
            font-size: 20px;
        }

        .delete-button:hover {
            color: #f44336;
        }

        .category-bread { background: linear-gradient(135deg, #ff9800, #ff6f00); }
        .category-dairy { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .category-meat { background: linear-gradient(135deg, #f44336, #d32f2f); }
        .category-vegetables { background: linear-gradient(135deg, #4caf50, #388e3c); }
        .category-sweets { background: linear-gradient(135deg, #e91e63, #c2185b); }
        .category-grocery { background: linear-gradient(135deg, #9c27b0, #7b1fa2); }
    </style>
</head>
<body>
    <div class="content" id="contentArea">
        <div class="recipes-stories">
            <div class="stories-container" id="storiesContainer">
                <div class="story-item active" data-recipe="main" onclick="switchToRecipe('main')">
                    <div class="story-circle">üõí</div>
                    <div class="story-name">–û—Å–Ω–æ–≤–Ω–æ–π</div>
                </div>
                <div class="story-item add-new" onclick="createNewRecipe()">
                    <div class="story-circle">+</div>
                    <div class="story-name">–ù–æ–≤—ã–π</div>
                </div>
            </div>
        </div>

        <button class="back-button" id="backButton" onclick="switchToRecipe('main')" style="display: none;">
            ‚Üê –ù–∞–∑–∞–¥
        </button>

        <div class="input-section">
            <div class="input-container">
                <input type="text" class="input-field" placeholder="–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç..." id="productInput">
                <button class="add-button" onclick="addProduct()">+</button>
            </div>
        </div>

        <div id="categoriesContainer">
            <!-- –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ - –ø—Ä–æ–¥—É–∫—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º -->
        </div>
    </div>

    <script>
        let currentRecipe = 'main';
        
        let recipeData = {
            main: { name: '–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫', products: [] }
        };

        let longPressTimer;
        let isLongPress = false;
        let touchStartX = 0;
        let touchStartY = 0;
        let longPressTarget = null;

        const categories = {
            'bread': {
                name: '–•–ª–µ–± –∏ –≤—ã–ø–µ—á–∫–∞',
                icon: 'ü•ñ',
                class: 'category-bread',
                keywords: ['—Ö–ª–µ–±', '–±—É–ª–æ—á–∫–∞', '–±–∞—Ç–æ–Ω', '–±–∞–≥–µ—Ç', '–ª–∞–≤–∞—à', '–ø–∏—Ç–∞', '–∫—Ä—É–∞—Å—Å–∞–Ω', '–∫–µ–∫—Å', '–ø–∏—Ä–æ–≥', '—Ç–æ—Ä—Ç', '–ø–µ—á–µ–Ω—å–µ', '—Å—É—à–∫–∏', '–±–∞—Ä–∞–Ω–∫–∏']
            },
            'dairy': {
                name: '–ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã',
                icon: 'ü•õ',
                class: 'category-dairy',
                keywords: ['–º–æ–ª–æ–∫–æ', '–∫–µ—Ñ–∏—Ä', '—Ä—è–∂–µ–Ω–∫–∞', '—Ç–≤–æ—Ä–æ–≥', '—Å–º–µ—Ç–∞–Ω–∞', '–π–æ–≥—É—Ä—Ç', '—Å—ã—Ä', '–º–∞—Å–ª–æ', '—Å–ª–∏–≤–∫–∏', '–ø—Ä–æ—Å—Ç–æ–∫–≤–∞—à–∞']
            },
            'meat': {
                name: '–ú—è—Å–æ –∏ —Ä—ã–±–∞',
                icon: 'ü•©',
                class: 'category-meat',
                keywords: ['–º—è—Å–æ', '–≥–æ–≤—è–¥–∏–Ω–∞', '—Å–≤–∏–Ω–∏–Ω–∞', '–∫—É—Ä–∏—Ü–∞', '–∏–Ω–¥–µ–π–∫–∞', '—Ä—ã–±–∞', '–∫–æ–ª–±–∞—Å–∞', '—Å–æ—Å–∏—Å–∫–∏', '—Ñ–∞—Ä—à', '–∫–æ—Ç–ª–µ—Ç—ã', '–æ–∫–æ—Ä–æ–∫', '–±–µ–∫–æ–Ω']
            },
            'vegetables': {
                name: '–û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã',
                icon: 'ü•ï',
                class: 'category-vegetables',
                keywords: ['–ø–æ–º–∏–¥–æ—Ä', '–æ–≥—É—Ä–µ—Ü', '–º–æ—Ä–∫–æ–≤—å', '–ª—É–∫', '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å', '–∫–∞–ø—É—Å—Ç–∞', '—è–±–ª–æ–∫–æ', '–±–∞–Ω–∞–Ω', '–∞–ø–µ–ª—å—Å–∏–Ω', '–≥—Ä—É—à–∞', '–≤–∏–Ω–æ–≥—Ä–∞–¥', '–∫–ª—É–±–Ω–∏–∫–∞', '–∞–≤–æ–∫–∞–¥–æ', '–ø–µ—Ä–µ—Ü', '—á–µ—Å–Ω–æ–∫']
            },
            'sweets': {
                name: '–°–ª–∞–¥–æ—Å—Ç–∏',
                icon: 'üç∞',
                class: 'category-sweets',
                keywords: ['—à–æ–∫–æ–ª–∞–¥', '–∫–æ–Ω—Ñ–µ—Ç—ã', '–º–∞—Ä–º–µ–ª–∞–¥', '–∑–µ—Ñ–∏—Ä', '–ø–∞—Å—Ç–∏–ª–∞', '—Ö–∞–ª–≤–∞', '–∫–∞—Ä–∞–º–µ–ª—å', '–ª–µ–¥–µ–Ω—Ü—ã', '–∂–≤–∞—á–∫–∞', '–º–æ—Ä–æ–∂–µ–Ω–æ–µ']
            },
            'grocery': {
                name: '–ë–∞–∫–∞–ª–µ—è',
                icon: 'üì¶',
                class: 'category-grocery',
                keywords: ['–∫—Ä—É–ø–∞', '—Ä–∏—Å', '–≥—Ä–µ—á–∫–∞', '–º–∞–∫–∞—Ä–æ–Ω—ã', '–º—É–∫–∞', '—Å–∞—Ö–∞—Ä', '—Å–æ–ª—å', '–º–∞—Å–ª–æ', '—É–∫—Å—É—Å', '—Å–ø–µ—Ü–∏–∏', '–∫–æ–Ω—Å–µ—Ä–≤—ã', '—á–∞–π', '–∫–æ—Ñ–µ', '—Å–æ–∫']
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            const dataToSave = {
                recipeData: recipeData,
                currentRecipe: currentRecipe
            };
            localStorage.setItem('shoppingListApp', JSON.stringify(dataToSave));
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('shoppingListApp');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    recipeData = data.recipeData || { main: { name: '–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫', products: [] } };
                    currentRecipe = data.currentRecipe || 'main';
                    
                    restoreStories();
                    switchToRecipe(currentRecipe);
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                recipeData = { main: { name: '–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫', products: [] } };
                currentRecipe = 'main';
            }
        }

        function restoreStories() {
            const storiesContainer = document.getElementById('storiesContainer');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            const mainStory = storiesContainer.querySelector('[data-recipe="main"]');
            const addButton = storiesContainer.querySelector('.add-new');
            
            // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
            const existingRecipes = storiesContainer.querySelectorAll('[data-recipe]:not([data-recipe="main"])');
            existingRecipes.forEach(recipe => recipe.remove());
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
            Object.keys(recipeData).forEach(recipeId => {
                if (recipeId !== 'main') {
                    const recipe = recipeData[recipeId];
                    const newStory = document.createElement('div');
                    newStory.className = 'story-item';
                    newStory.setAttribute('data-recipe', recipeId);
                    
                    // –í–∞–∂–Ω–æ: —Å–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∑–∞–Ω–æ–≤–æ
                    newStory.addEventListener('click', function() { 
                        switchToRecipe(recipeId); 
                    });
                    newStory.addEventListener('mousedown', function(e) { 
                        startStoryLongPress(e, this); 
                    });
                    newStory.addEventListener('mouseup', endStoryLongPress);
                    newStory.addEventListener('touchstart', function(e) { 
                        startStoryLongPress(e, this); 
                    });
                    newStory.addEventListener('touchend', endStoryLongPress);
                    
                    newStory.innerHTML = '<div class="story-circle">üçΩÔ∏è</div><div class="story-name">' + recipe.name + '</div>';
                    
                    // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                    storiesContainer.insertBefore(newStory, addButton);
                }
            });
        }

        function startStoryLongPress(event, element) {
            event.preventDefault();
            longPressTarget = element;
            longPressTimer = setTimeout(() => {
                const recipeId = element.getAttribute('data-recipe');
                if (recipeId !== 'main') {
                    deleteRecipe(recipeId);
                }
            }, 600);
        }

        function endStoryLongPress(event) {
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
            longPressTarget = null;
        }

        function saveCurrentRecipeData() {
            const products = [];
            document.querySelectorAll('.item').forEach(item => {
                const text = item.querySelector('.item-text').textContent;
                const isCompleted = item.classList.contains('completed');
                const categorySection = item.closest('.category-section');
                const categoryId = categorySection.getAttribute('data-category');
                
                products.push({
                    text: text,
                    completed: isCompleted,
                    category: categoryId
                });
            });
            
            recipeData[currentRecipe].products = products;
        }

        function updateActiveStory(recipeId) {
            document.querySelectorAll('.story-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('[data-recipe="' + recipeId + '"]').classList.add('active');
        }

        function switchToRecipe(recipeId) {
            if (document.querySelectorAll('.item').length > 0) {
                saveCurrentRecipeData();
            }
            
            currentRecipe = recipeId;
            
            updateActiveStory(recipeId);
            loadRecipeData(recipeId);
            
            saveData();
        }

        function createNewRecipe() {
            const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞:');
            if (!name) return;
            
            const recipeId = 'recipe_' + Date.now();
            
            recipeData[recipeId] = { name: name, products: [] };
            
            const newStory = document.createElement('div');
            newStory.className = 'story-item';
            newStory.setAttribute('data-recipe', recipeId);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º addEventListener –≤–º–µ—Å—Ç–æ onclick –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
            newStory.addEventListener('click', function() { 
                switchToRecipe(recipeId); 
            });
            newStory.addEventListener('mousedown', function(e) { 
                startStoryLongPress(e, this); 
            });
            newStory.addEventListener('mouseup', endStoryLongPress);
            newStory.addEventListener('touchstart', function(e) { 
                startStoryLongPress(e, this); 
            });
            newStory.addEventListener('touchend', endStoryLongPress);
            
            newStory.innerHTML = '<div class="story-circle">üçΩÔ∏è</div><div class="story-name">' + name + '</div>';
            
            const addButton = document.querySelector('.story-item.add-new');
            addButton.parentNode.insertBefore(newStory, addButton);
            
            switchToRecipe(recipeId);
            saveData();
        }

        function deleteRecipe(recipeId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —Å–ø–∏—Å–æ–∫ "' + recipeData[recipeId].name + '"?')) {
                delete recipeData[recipeId];
                
                const storyElement = document.querySelector('[data-recipe="' + recipeId + '"]');
                if (storyElement) {
                    storyElement.remove();
                }
                
                switchToRecipe('main');
                saveData();
            }
        }

        function loadRecipeData(recipeId) {
            document.getElementById('categoriesContainer').innerHTML = '';
            
            const products = recipeData[recipeId].products;
            
            products.forEach(product => {
                addProductToUI(product.text, product.category, product.completed);
            });
        }

        function addProductToUI(productText, categoryId, isCompleted) {
            isCompleted = isCompleted || false;
            const category = categories[categoryId];
            
            let categorySection = document.querySelector('[data-category="' + categoryId + '"]');
            
            if (!categorySection) {
                categorySection = createCategorySection(categoryId, category);
                document.getElementById('categoriesContainer').appendChild(categorySection);
            }
            
            const itemsContainer = categorySection.querySelector('.category-items');
            const item = createProductItem(productText);
            
            if (isCompleted) {
                item.classList.add('completed');
                item.querySelector('.checkbox').classList.add('checked');
            }
            
            itemsContainer.appendChild(item);
            updateCategoryCount(categorySection);
        }

        function parseProduct(input) {
            const text = input.trim();
            
            const patterns = [
                /^(\d+)\s+(.+)$/,
                /^(\d+)\s*—à—Ç\.?\s+(.+)$/i,
                /^(\d+)\s*—à—Ç—É–∫[–∏–∞]?\s+(.+)$/i,
                /^(\d+)\s*–∫–≥\.?\s+(.+)$/i,
                /^(\d+)\s*–ª\.?\s+(.+)$/i,
                /^(\d+)\s*–≥\.?\s+(.+)$/i
            ];
            
            for (let pattern of patterns) {
                const match = text.match(pattern);
                if (match) {
                    const quantity = parseInt(match[1]);
                    const name = match[2].trim();
                    return { name, quantity };
                }
            }
            
            return { name: text, quantity: 1 };
        }

        function categorizeProduct(productName) {
            const name = productName.toLowerCase();
            
            for (let categoryId in categories) {
                const category = categories[categoryId];
                for (let keyword of category.keywords) {
                    if (name.includes(keyword)) {
                        return categoryId;
                    }
                }
            }
            
            return 'grocery';
        }

        function addProduct() {
            const input = document.getElementById('productInput');
            const inputText = input.value.trim();
            
            if (!inputText) return;
            
            const parsed = parseProduct(inputText);
            const categoryId = categorizeProduct(parsed.name);
            
            let displayName = parsed.name;
            if (parsed.quantity > 1) {
                displayName += ' (' + parsed.quantity + ' —à—Ç)';
            }
            
            let existingStatus = false;
            if (currentRecipe !== 'main') {
                const mainProducts = recipeData.main.products;
                for (let i = 0; i < mainProducts.length; i++) {
                    if (mainProducts[i].text === displayName) {
                        existingStatus = mainProducts[i].completed;
                        break;
                    }
                }
            }
            
            addProductToUI(displayName, categoryId, existingStatus);
            
            if (currentRecipe !== 'main') {
                let alreadyExists = false;
                const mainProducts = recipeData.main.products;
                for (let i = 0; i < mainProducts.length; i++) {
                    if (mainProducts[i].text === displayName) {
                        alreadyExists = true;
                        break;
                    }
                }
                
                if (!alreadyExists) {
                    recipeData.main.products.push({
                        text: displayName,
                        completed: existingStatus,
                        category: categoryId
                    });
                }
            }
            
            input.value = '';
            saveCurrentRecipeData();
            saveData();
        }

        function createCategorySection(categoryId, category) {
            const section = document.createElement('div');
            section.className = 'category-section';
            section.setAttribute('data-category', categoryId);
            
            section.innerHTML = '<div class="category-header ' + category.class + '"><div class="category-title"><span style="font-size: 20px; margin-right: 8px;">' + category.icon + '</span>' + category.name + '</div><div class="category-count">0</div></div><div class="category-items"></div>';
            
            return section;
        }

        function createProductItem(productName) {
            const item = document.createElement('div');
            item.className = 'item';
            
            item.innerHTML = '<div class="checkbox" onclick="toggleItem(this)"></div><div class="item-text">' + productName + '</div><span class="delete-button" onclick="deleteItem(this)">√ó</span>';
            
            return item;
        }

        function toggleItem(checkbox) {
            const item = checkbox.closest('.item');
            const isChecked = checkbox.classList.contains('checked');
            const productText = item.querySelector('.item-text').textContent;
            
            if (isChecked) {
                checkbox.classList.remove('checked');
                item.classList.remove('completed');
                syncProductStatus(productText, false);
            } else {
                checkbox.classList.add('checked');
                item.classList.add('completed');
                syncProductStatus(productText, true);
            }
            
            saveCurrentRecipeData();
            saveData();
        }

        function syncProductStatus(productText, isCompleted) {
            for (let recipeId in recipeData) {
                const products = recipeData[recipeId].products;
                for (let i = 0; i < products.length; i++) {
                    if (products[i].text === productText) {
                        products[i].completed = isCompleted;
                    }
                }
            }
            
            document.querySelectorAll('.item').forEach(itemElement => {
                const itemText = itemElement.querySelector('.item-text').textContent;
                if (itemText === productText) {
                    const itemCheckbox = itemElement.querySelector('.checkbox');
                    if (isCompleted) {
                        itemCheckbox.classList.add('checked');
                        itemElement.classList.add('completed');
                    } else {
                        itemCheckbox.classList.remove('checked');
                        itemElement.classList.remove('completed');
                    }
                }
            });
        }

        function deleteItem(deleteButton) {
            const item = deleteButton.closest('.item');
            const categorySection = deleteButton.closest('.category-section');
            const productText = item.querySelector('.item-text').textContent;
            
            const currentProducts = recipeData[currentRecipe].products;
            for (let i = currentProducts.length - 1; i >= 0; i--) {
                if (currentProducts[i].text === productText) {
                    currentProducts.splice(i, 1);
                    break;
                }
            }
            
            let existsInOtherRecipes = false;
            for (let recipeId in recipeData) {
                if (recipeId !== currentRecipe) {
                    const products = recipeData[recipeId].products;
                    for (let i = 0; i < products.length; i++) {
                        if (products[i].text === productText) {
                            existsInOtherRecipes = true;
                            break;
                        }
                    }
                    if (existsInOtherRecipes) break;
                }
            }
            
            if (!existsInOtherRecipes && currentRecipe !== 'main') {
                const mainProducts = recipeData.main.products;
                for (let i = mainProducts.length - 1; i >= 0; i--) {
                    if (mainProducts[i].text === productText) {
                        mainProducts.splice(i, 1);
                        break;
                    }
                }
            }
            
            item.remove();
            updateCategoryCount(categorySection);
            
            const itemsContainer = categorySection.querySelector('.category-items');
            if (itemsContainer.children.length === 0) {
                categorySection.remove();
            }
            
            saveData();
        }

        function updateCategoryCount(categorySection) {
            const items = categorySection.querySelectorAll('.item');
            const countElement = categorySection.querySelector('.category-count');
            countElement.textContent = items.length;
        }

        function startLongPress(event) {
            // –ë–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
        }

        function endLongPress(event) {
            // –ë–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            if (document.querySelectorAll('.item').length > 0) {
                saveCurrentRecipeData();
            }
            
            document.querySelectorAll('.category-section').forEach(updateCategoryCount);
            
            const contentArea = document.getElementById('contentArea');
            if (contentArea) {
                contentArea.addEventListener('touchstart', function(e) {
                    if (currentRecipe === 'main') return;
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                });

                contentArea.addEventListener('touchend', function(e) {
                    if (currentRecipe === 'main' || !touchStartX || !touchStartY) return;

                    let touchEndX = e.changedTouches[0].clientX;
                    let touchEndY = e.changedTouches[0].clientY;
                    
                    let diffX = touchStartX - touchEndX;
                    let diffY = touchStartY - touchEndY;
                    
                    if (Math.abs(diffX) > Math.abs(diffY) && diffX > 80) {
                        e.preventDefault();
                        switchToRecipe('main');
                    }
                    
                    touchStartX = 0;
                    touchStartY = 0;
                });
            }
        });

        document.getElementById('productInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addProduct();
            }
        });
    </script>
</body>
</html>